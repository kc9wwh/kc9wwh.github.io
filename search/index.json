[{"content":"Running Commands as the Active User on Linux with Fleet If you\u0026rsquo;ve ever tried to display a notification or launch a browser from Fleet on a Linux system, you\u0026rsquo;ve probably run into a frustrating wall: Fleet runs as root, but graphical applications need to run in the user\u0026rsquo;s session.\nRunning notify-send as root does nothing. The notification never appears because it\u0026rsquo;s not connected to the user\u0026rsquo;s display server. Same story with launching Firefox or installing user-specific applications. They need the right environment variables, the right user context, and the right permissions.\nAfter seeing customers wrestle with this problem, I built fleet_run_as_user.sh, a modular library that handles the complexity of executing commands in the active user\u0026rsquo;s graphical session.\nüìÅ Get the library on GitHub ‚Üí\nThe Problem: Root vs. User Context Fleet executes scripts with root privileges. That\u0026rsquo;s great for system-level tasks like installing packages or modifying system files. But it creates a challenge when you need to:\nDisplay notifications to the logged-in user Launch applications in the user\u0026rsquo;s GUI environment Install software in user space (like browser extensions) Run scripts that require access to user files or settings The issue boils down to environment variables and permissions. A graphical application needs:\nDISPLAY or WAYLAND_DISPLAY (to know which screen to use) XAUTHORITY (for X11 authentication) DBUS_SESSION_BUS_ADDRESS (for D-Bus communication) XDG_RUNTIME_DIR (for Wayland runtime files) The correct user ID and session context When you run a command as root, none of these are set correctly. The library solves this by discovering the active session and reconstructing the user\u0026rsquo;s environment.\nHow It Works: Three-Step Process The library follows a simple pattern:\n1. Find the Active Session The find_active_session() function uses loginctl to identify the active graphical user session. It tries multiple strategies:\nFirst, look for a session with seat0 (physical display) If that fails, find any graphical session Fall back to any user session (excluding system sessions) Once found, it extracts three critical pieces:\nSESSION_ID (the session identifier) SESSION_USER (the username) SESSION_UID (the user\u0026rsquo;s numeric ID) 2. Extract Display Environment The get_display_environment() function reconstructs the user\u0026rsquo;s graphical environment by reading process environment files from /proc. It:\nStarts with the session leader process Searches other user processes if needed Extracts display server variables (DISPLAY, WAYLAND_DISPLAY) Captures authentication tokens (XAUTHORITY, DBUS_SESSION_BUS_ADDRESS) Sets runtime directory paths (XDG_RUNTIME_DIR) Falls back to sensible defaults if variables aren\u0026rsquo;t found This approach works for both X11 and Wayland display servers.\n3. Execute in User Context With session info and environment variables in hand, the library provides two execution functions:\nrun_as_session_user runs commands as the user WITHOUT graphical environment\nUse for: File operations, background tasks, non-GUI commands run_as_graphical_user runs commands WITH full graphical environment\nUse for: Notifications, browser launches, GUI applications Implementation: Two Ways to Use It Option 1: As a Library (Recommended) Source the script and call functions directly:\n1 2 3 4 5 6 7 8 9 10 11 12 13 #!/bin/bash source /path/to/fleet_run_as_user.sh # Initialize ensure_root || exit 1 find_active_session || exit 1 get_display_environment || exit 1 # Show a notification show_notification \u0026#34;Security Update\u0026#34; \u0026#34;Please restart your device\u0026#34; \u0026#34;critical\u0026#34; # Launch a browser to your internal portal launch_browser \u0026#34;https://portal.yourcompany.com\u0026#34; \u0026#34;firefox\u0026#34; Option 2: Modify the Main Function The script includes a main() function with examples. Uncomment and customize:\n1 2 3 4 5 6 7 8 main() { ensure_root || exit 1 find_active_session || exit 1 get_display_environment || exit 1 # Your custom action here run_as_graphical_user \u0026#34;notify-send \u0026#39;Fleet\u0026#39; \u0026#39;Compliance check complete\u0026#39;\u0026#34; } Then execute the script directly from Fleet.\nReal-World Use Cases Compliance Notifications\nNotify users when their device falls out of compliance:\n1 show_notification \u0026#34;Action Required\u0026#34; \u0026#34;Your system is missing security updates. Please update within 24 hours.\u0026#34; \u0026#34;critical\u0026#34; Self-Service Portal\nLaunch a browser to your internal support portal:\n1 launch_browser \u0026#34;https://support.company.com/ticket/12345\u0026#34; \u0026#34;google-chrome\u0026#34; User-Space Application Installation\nInstall browser extensions or user-specific tools:\n1 run_as_session_user \u0026#34;pip install --user your-package\u0026#34; Pre-Restart Warnings\nGive users a heads-up before forced reboots:\n1 2 3 show_notification \u0026#34;System Maintenance\u0026#34; \u0026#34;Your device will restart in 5 minutes. Please save your work.\u0026#34; \u0026#34;critical\u0026#34; sleep 300 reboot Why It Works: The Technical Details loginctl vs. who\nThe library uses loginctl instead of parsing who or w because it provides structured session data including session type (graphical vs. non-graphical) and seat information.\nProcess Environment Discovery\nReading /proc/\u0026lt;pid\u0026gt;/environ gives us the actual environment variables from running processes. The library searches multiple processes because not all user processes inherit all variables.\nFallback Defaults\nIf environment variables aren\u0026rsquo;t found, the library uses reasonable defaults (:0 for DISPLAY, wayland-0 for Wayland). This handles edge cases where variables aren\u0026rsquo;t set consistently.\nX11 and Wayland Support\nBy checking for both DISPLAY and WAYLAND_DISPLAY, the library works regardless of which display server the distribution uses.\nTroubleshooting Enable debug mode to see what\u0026rsquo;s happening:\n1 DEBUG=1 ./fleet_run_as_user.sh Common issues:\n\u0026ldquo;Could not find an active user session\u0026rdquo; - No user is logged in graphically \u0026ldquo;Display environment not set\u0026rdquo; - Call get_display_environment before run_as_graphical_user \u0026ldquo;This script must be run as root\u0026rdquo; - The script needs root privileges to switch users Best Practices Always check return codes\n1 2 3 4 if ! find_active_session; then error_log \u0026#34;No active session found\u0026#34; exit 1 fi Use the right function\nrun_as_session_user for file operations and background tasks run_as_graphical_user for anything that needs a display Test with DEBUG=1\nBefore deploying to production, test with debug logging enabled to verify the correct session and environment are detected.\nHandle no-user scenarios\nNot all Linux systems have an active graphical user. Add fallback logic for headless servers or systems where no one is logged in.\nGetting Started Download the library to your Fleet scripts repository Test locally with DEBUG=1 enabled Create a Fleet script that sources the library Deploy to a test group before rolling out broadly The library is modular, well-documented, and handles the edge cases that make this problem tricky. Whether you\u0026rsquo;re pushing compliance notifications, launching self-service portals, or installing user-specific software, it gives you the building blocks to execute commands in the user\u0026rsquo;s context reliably.\nQuestions? Drop them in the comments or reach out to the Fleet community on Slack. If you\u0026rsquo;ve built something cool with this library, I\u0026rsquo;d love to hear about it.\nContributing? The library is designed to be extended. Have ideas for additional convenience functions? Submit a PR or share your use case.\nCatch ya on the next project!\nJosh üññ\nPhoto by Gabriel Heinzer on Unsplash\n","date":"2025-10-30T23:52:59Z","image":"https://kc9wwh.net/p/running-commands-as-the-active-user-on-linux-with-fleet/cover_hu_8353e6d55db75bda.jpg","permalink":"https://kc9wwh.net/p/running-commands-as-the-active-user-on-linux-with-fleet/","title":"Running Commands as the Active User on Linux with Fleet"},{"content":"Introduction: Unleash the Power of Fleet with Docker! In today\u0026rsquo;s complex digital landscape, achieving comprehensive endpoint visibility is paramount for robust security and efficient IT operations. Fleet, an open-source platform, leverages the power of osquery to provide deep insights into device fleets, covering Linux, macOS, Windows, and even Chromebooks. It\u0026rsquo;s a versatile tool for vulnerability reporting, detection engineering, device management (MDM), and monitoring device health. However, setting up any powerful platform can sometimes seem daunting, particularly when considering resource allocation for testing or initial exploration.\nThis is where the magic of Docker comes into play. This guide demonstrates how to launch a fully functional Fleet environment‚Äîcomplete with its necessary database and caching layer‚Äîusing individual docker run commands. This approach offers a lightweight, fast, and isolated method to get hands-on with Fleet, making it ideal for IT and security professionals, DevOps engineers, or anyone curious to explore osquery management at scale with minimal upfront commitment.\nWhy Docker for Fleet? The \u0026ldquo;Easy Button\u0026rdquo; Approach Utilizing Docker for deploying Fleet presents several compelling advantages, especially for evaluation, development, or smaller-scale use cases:\nSimplicity: Docker encapsulates each component of the Fleet stack (Fleet server, MySQL database, Redis cache) into its own container. This packaging simplifies deployment and dependency management. Speed: With a few Docker commands, the entire stack can be provisioned and running in minutes. Similarly, tearing down the environment is just as quick, leaving the host system clean. Isolation: Containers run in isolated environments, preventing conflicts with other software or configurations on the host machine. This is perfect for testing without impacting existing setups. Resource Efficiency: Docker containers are generally more lightweight than full virtual machines. This makes it feasible to run Fleet on a local machine or a small server for testing purposes. Consistency: Docker ensures that the Fleet environment is consistent across different machines, from a developer\u0026rsquo;s laptop to a test server. Prerequisites: What\u0026rsquo;s Needed To embark on this Dockerized Fleet journey, only a few items are necessary:\nDocker Engine installed on the host system. Basic familiarity with command-line interface (CLI) operations. A spirit of exploration to dive into the capabilities of Fleet! The Architecture: The Dockerized Fleet Stack The setup will consist of the following components, all running in separate Docker containers:\nfleetdm/fleet:latest: The core Fleet server application. mysql:8.0.36: A MySQL database instance to store Fleet\u0026rsquo;s metadata. redis: A Redis instance used by Fleet for caching and managing live query sessions. These containers will communicate over the host network, so it\u0026rsquo;s important to ensure the IP address used for configuration is accessible from the containers.\nLet\u0026rsquo;s Get Building! Step-by-Step with Docker Run This section walks through the commands needed to bring the Fleet stack to life.\nStep 1: Prepare Host Directories Before launching the containers, you need to create the directories on your host machine that will be used for persistent storage. This ensures your data isn\u0026rsquo;t lost when containers are stopped or removed.\n1 2 3 4 5 # Create directories for MySQL mkdir -p /mnt/user/appdata/mysql/{data,logs,conf.d,initdb} # Create directory for Fleet mkdir -p /mnt/user/appdata/fleetdm Step 2: Launch the MySQL Container Run the following command to start the MySQL database. This command maps ports and volumes for data persistence and logging.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 docker run \\ -d \\ --name=\u0026#39;MySQL\u0026#39; \\ --net=\u0026#39;bridge\u0026#39; \\ --pids-limit 2048 \\ --privileged=true \\ -e TZ=\u0026#34;America/Chicago\u0026#34; \\ -e \u0026#39;MYSQL_DATABASE\u0026#39;=\u0026#39;fleet\u0026#39; \\ -e \u0026#39;MYSQL_USER\u0026#39;=\u0026#39;fleet-user\u0026#39; \\ -e \u0026#39;MYSQL_PASSWORD\u0026#39;=\u0026#39;fleet-user-password\u0026#39; \\ -e \u0026#39;MYSQL_ROOT_PASSWORD\u0026#39;=\u0026#39;super-secret-password\u0026#39; \\ -p \u0026#39;3306:3306/tcp\u0026#39; \\ -v \u0026#39;/mnt/user/appdata/mysql/data\u0026#39;:\u0026#39;/var/lib/mysql\u0026#39;:\u0026#39;rw\u0026#39; \\ -v \u0026#39;/mnt/user/appdata/mysql/logs\u0026#39;:\u0026#39;/var/log/mysql\u0026#39;:\u0026#39;rw\u0026#39; \\ -v \u0026#39;/mnt/user/appdata/mysql/conf.d\u0026#39;:\u0026#39;/etc/mysql/conf.d\u0026#39;:\u0026#39;rw\u0026#39; \\ -v \u0026#39;/mnt/user/appdata/mysql/initdb\u0026#39;:\u0026#39;/docker-entrypoint-initdb.d\u0026#39;:\u0026#39;rw\u0026#39; \\ --memory=2G \\ --restart=unless-stopped \\ \u0026#39;mysql:8.0.36\u0026#39; mysqld \\ --log-error=/var/log/mysql/error.log Step 3: Launch the Redis Container Next, start the Redis container. It\u0026rsquo;s a simpler setup, primarily needing a port mapping.\n1 2 3 4 5 6 7 8 docker run \\ -d \\ --name=\u0026#39;Redis\u0026#39; \\ --net=\u0026#39;bridge\u0026#39; \\ --pids-limit 2048 \\ -e TZ=\u0026#34;America/Chicago\u0026#34; \\ -p \u0026#39;6379:6379/tcp\u0026#39; \\ \u0026#39;redis\u0026#39; Step 4: Launch the Fleet Server Finally, launch the Fleet server. This command is the most extensive, as it includes configuration details to connect to the MySQL and Redis containers.\nNote: Make sure to replace 192.168.50.129 in the FLEET_MYSQL_ADDRESS and FLEET_REDIS_ADDRESS variables with the actual IP address of your Docker host.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 docker run \\ -d \\ --name=\u0026#39;fleetdm\u0026#39; \\ --net=\u0026#39;bridge\u0026#39; \\ --pids-limit 2048 \\ -e TZ=\u0026#34;America/Chicago\u0026#34; \\ -e \u0026#39;FLEET_MYSQL_ADDRESS\u0026#39;=\u0026#39;192.168.50.129:3306\u0026#39; \\ -e \u0026#39;FLEET_MYSQL_DATABASE\u0026#39;=\u0026#39;fleet\u0026#39; \\ -e \u0026#39;FLEET_MYSQL_USERNAME\u0026#39;=\u0026#39;fleet-user\u0026#39; \\ -e \u0026#39;FLEET_MYSQL_PASSWORD\u0026#39;=\u0026#39;fleet-user-password\u0026#39; \\ -e \u0026#39;FLEET_REDIS_ADDRESS\u0026#39;=\u0026#39;192.168.50.129:6379\u0026#39; \\ -e \u0026#39;FLEET_OSQUERY_STATUS_LOG_PLUGIN\u0026#39;=\u0026#39;filesystem\u0026#39; \\ -e \u0026#39;FLEET_OSQUERY_RESULT_LOG_PLUGIN\u0026#39;=\u0026#39;filesystem\u0026#39; \\ -e \u0026#39;FLEET_FILESYSTEM_STATUS_LOG_FILE\u0026#39;=\u0026#39;/mnt/data/logs/status.log\u0026#39; \\ -e \u0026#39;FLEET_FILESYSTEM_RESULT_LOG_FILE\u0026#39;=\u0026#39;/mnt/data/logs/result.log\u0026#39; \\ -e \u0026#39;FLEET_FILESYSTEM_AUDIT_LOG_FILE\u0026#39;=\u0026#39;/mnt/data/logs/audit.log\u0026#39; \\ -e \u0026#39;FLEET_FILESYSTEM_ENABLE_LOG_ROTATION\u0026#39;=\u0026#39;true\u0026#39; \\ -e \u0026#39;FLEET_ACTIVITY_ENABLE_AUDIT_LOG\u0026#39;=\u0026#39;true\u0026#39; \\ -e \u0026#39;FLEET_ACTIVITY_AUDIT_LOG_PLUGIN\u0026#39;=\u0026#39;filesystem\u0026#39; \\ -e \u0026#39;FLEET_LOGGING_DEBUG\u0026#39;=\u0026#39;true\u0026#39; \\ -e \u0026#39;FLEET_SERVER_TLS\u0026#39;=\u0026#39;false\u0026#39; \\ -p \u0026#39;8083:8080/tcp\u0026#39; \\ -p \u0026#39;8443:443/tcp\u0026#39; \\ -v \u0026#39;/mnt/user/appdata/fleetdm\u0026#39;:\u0026#39;/mnt/data\u0026#39;:\u0026#39;rw\u0026#39; \\ \u0026#39;fleetdm/fleet:latest\u0026#39; sh \\ -c \u0026#34;fleet prepare db \u0026amp;\u0026amp; fleet serve\u0026#34; To monitor the logs, especially for the Fleet server, you can run:\n1 docker logs -f fleetdm Look for messages indicating successful database migrations and that the server has started.\nStep 5: Accessing the Fleet UI Once the containers are running, the Fleet UI should be accessible. Open a web browser and navigate to:\nhttp://\u0026lt;YOUR_DOCKER_HOST_IP\u0026gt;:8083\nThe first time you access Fleet, a setup screen will appear to create an administrator account. Follow the on-screen prompts. After setting up the admin user, you will be presented with the Fleet dashboard.\nBONUS ROUND: Enroll Your First Osquery Agent! A Fleet server is most useful when it has agents reporting in. You can run an osquery agent as another Docker container.\nObtain Enroll Secret:\nIn the Fleet UI, navigate to Hosts and click the Add hosts button. Fleet will display an enroll secret. Copy this secret for the next step. Run the Osquery Agent Container: Open a terminal and execute the following command.\nReplace YOUR_ENROLL_SECRET_FROM_FLEET_UI with the actual secret from the UI. Replace 192.168.50.129 with your Docker host\u0026rsquo;s IP address. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 ENROLL_SECRET=\u0026#34;YOUR_ENROLL_SECRET_FROM_FLEET_UI\u0026#34; FLEET_URL=\u0026#34;192.168.50.129:8083\u0026#34; docker run -d --name osquery-agent-test \\ osquery/osquery:latest osqueryd \\ --enroll_secret=${ENROLL_SECRET} \\ --tls_hostname=${FLEET_URL} \\ --enroll_tls_endpoint=/api/osquery/enroll \\ --config_plugin=tls \\ --config_tls_endpoint=/api/osquery/config \\ --logger_plugin=tls \\ --logger_tls_endpoint=/api/osquery/log \\ --disable_distributed=false \\ --distributed_plugin=tls \\ --distributed_tls_read_endpoint=/api/osquery/distributed/read \\ --distributed_tls_write_endpoint=/api/osquery/distributed/write \\ --host_identifier=uuid \\ --force=true \\ --verbose=false \\ --tls_allow_unsafe=true After a few moments, the new host should appear on the Hosts page in the Fleet UI.\nCleaning Up: Returning to Shore When you\u0026rsquo;re finished exploring, you can cleanly remove the entire Fleet stack.\nStop the Containers:\n1 docker stop MySQL Redis fleetdm osquery-agent-test Remove the Containers:\n1 docker rm MySQL Redis fleetdm osquery-agent-test (Optional) Remove Host Directories: If you want to remove all persisted data, you can delete the directories you created earlier:\n1 2 rm -rf /mnt/user/appdata/mysql rm -rf /mnt/user/appdata/fleetdm And just like that, the system is back to its original state. This ease of teardown is invaluable for experimentation.\nTeaser for Part 2 - S3 Storage! Feeling adventurous? Ready to take this Fleet setup to the next frontier? This Dockerized deployment is fantastic for getting started, but for more persistent or larger-scale scenarios, especially involving log retention and file carving, a more robust storage solution is beneficial.\nStay Tuned! In the next article in this series, the Fleet deployment will be supercharged by configuring S3-compatible object storage (using MinIO, all in Docker, of course!) for scalable log and file carve storage. Imagine effortlessly storing and managing extensive endpoint data!\nCatch ya on the next project!\nJosh üññ\nPhoto by Mohammad Rahmani on Unsplash\n","date":"2025-06-09T12:33:38Z","image":"https://kc9wwh.net/p/getting-started-with-fleet/cover_hu_5f5c7cc967b2cf98.jpg","permalink":"https://kc9wwh.net/p/getting-started-with-fleet/","title":"Getting started with Fleet"},{"content":"About a month ago I setup Fleet Device Management and since then there have been a couple updates that have come out and along with that some required database migrations or updates that needed to happen. Unlike with other MDM\u0026rsquo;s I\u0026rsquo;ve used in the past, the migrations that needed to happen on the database do not auto apply when an upgraded version is ran against it. Instead, you need to manually complete them.\nNow I\u0026rsquo;ve see these warning for a couple of weeks, but kept putting them off. Until today at least, as after updating my fleetdm/fleet docker container to the latest version, Fleet would no longer startup. ruh-roh!\nWhat is the first thing we do when a server doesn\u0026rsquo;t boot, we try again\u0026hellip;only, that didn\u0026rsquo;t work.\nWhats the second thing we do? That\u0026rsquo;s right! We check the logs, and those logs were all about telling me I really need to do these database migrations. But how since the docker container immediately stops after starting it?\nFirst we need to understand why the container keeps stopping. That is because unless a docker container is doing something (i.e., a service is actively running on the container), docker, will stop the container to save on resources being wasted. So, how do we overcome this when the container isn\u0026rsquo;t doing what we want it to do? We give it something else to do, by having it run tail against /dev/null.\nNormal docker run Command:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 docker run -d --name=\u0026#39;fleetdm\u0026#39; --net=\u0026#39;bridge\u0026#39; --pids-limit 2048 -e TZ=\u0026#34;America/Chicago\u0026#34; -e HOST_HOSTNAME=\u0026#34;Loki\u0026#34; -e HOST_CONTAINERNAME=\u0026#34;fleetdm\u0026#34; -e \u0026#39;FLEET_MYSQL_ADDRESS\u0026#39;=\u0026#39;10.0.10.82:3306\u0026#39; -e \u0026#39;FLEET_MYSQL_DATABASE\u0026#39;=\u0026#39;YOUR_FLEET_DB\u0026#39; -e \u0026#39;FLEET_MYSQL_USERNAME\u0026#39;=\u0026#39;YOUR_FLEET_USER\u0026#39; -e \u0026#39;FLEET_MYSQL_PASSWORD\u0026#39;=\u0026#39;YOUR_FLEET_PASS\u0026#39; -e \u0026#39;FLEET_REDIS_ADDRESS\u0026#39;=\u0026#39;192.168.50.129:6379\u0026#39; -e \u0026#39;FLEET_SERVER_CERT\u0026#39;=\u0026#39;/mnt/data/certs/certificate.crt\u0026#39; -e \u0026#39;FLEET_SERVER_KEY\u0026#39;=\u0026#39;/mnt/data/certs/private.key\u0026#39; -e \u0026#39;FLEET_MDM_WINDOWS_WSTEP_IDENTITY_CERT\u0026#39;=\u0026#39;/mnt/data/win_mdm_certs/fleet-mdm-win-wstep.crt\u0026#39; -e \u0026#39;FLEET_MDM_WINDOWS_WSTEP_IDENTITY_KEY\u0026#39;=\u0026#39;/mnt/data/win_mdm_certs/fleet-mdm-win-wstep.key\u0026#39; -e \u0026#39;FLEET_SERVER_PRIVATE_KEY\u0026#39;=\u0026#39;YOUR_SERVER_PRIVATE_KEY\u0026#39; -e \u0026#39;FLEET_LICENSE_KEY\u0026#39;=\u0026#39;YOUR_KEY_HERE\u0026#39; -e \u0026#39;FLEET_OSQUERY_STATUS_LOG_PLUGIN\u0026#39;=\u0026#39;filesystem\u0026#39; -e \u0026#39;FLEET_OSQUERY_RESULT_LOG_PLUGIN\u0026#39;=\u0026#39;filesystem\u0026#39; -e \u0026#39;FLEET_FILESYSTEM_STATUS_LOG_FILE\u0026#39;=\u0026#39;/mnt/data/logs/status.log\u0026#39; -e \u0026#39;FLEET_FILESYSTEM_RESULT_LOG_FILE\u0026#39;=\u0026#39;/mnt/data/logs/result.log\u0026#39; -e \u0026#39;FLEET_FILESYSTEM_AUDIT_LOG_FILE\u0026#39;=\u0026#39;/mnt/data/logs/audit.log\u0026#39; -e \u0026#39;FLEET_FILESYSTEM_ENABLE_LOG_ROTATION\u0026#39;=\u0026#39;true\u0026#39; -e \u0026#39;FLEET_ACTIVITY_ENABLE_AUDIT_LOG\u0026#39;=\u0026#39;true\u0026#39; -e \u0026#39;FLEET_ACTIVITY_AUDIT_LOG_PLUGIN\u0026#39;=\u0026#39;filesystem\u0026#39; -e \u0026#39;FLEET_LOGGING_DEBUG\u0026#39;=\u0026#39;true\u0026#39; -p \u0026#39;8081:8080/tcp\u0026#39; -v \u0026#39;/mnt/user/appdata/fleetdm\u0026#39;:\u0026#39;/mnt/data\u0026#39;:\u0026#39;rw\u0026#39; \u0026#39;fleetdm/fleet\u0026#39; Normal docker run w/ Tail Command:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 docker run -d --name=\u0026#39;fleetdm\u0026#39; --net=\u0026#39;bridge\u0026#39; --pids-limit 2048 -e TZ=\u0026#34;America/Chicago\u0026#34; -e HOST_HOSTNAME=\u0026#34;Loki\u0026#34; -e HOST_CONTAINERNAME=\u0026#34;fleetdm\u0026#34; -e \u0026#39;FLEET_MYSQL_ADDRESS\u0026#39;=\u0026#39;10.0.10.82:3306\u0026#39; -e \u0026#39;FLEET_MYSQL_DATABASE\u0026#39;=\u0026#39;YOUR_FLEET_DB\u0026#39; -e \u0026#39;FLEET_MYSQL_USERNAME\u0026#39;=\u0026#39;YOUR_FLEET_USER\u0026#39; -e \u0026#39;FLEET_MYSQL_PASSWORD\u0026#39;=\u0026#39;YOUR_FLEET_PASS\u0026#39; -e \u0026#39;FLEET_REDIS_ADDRESS\u0026#39;=\u0026#39;192.168.50.129:6379\u0026#39; -e \u0026#39;FLEET_SERVER_CERT\u0026#39;=\u0026#39;/mnt/data/certs/certificate.crt\u0026#39; -e \u0026#39;FLEET_SERVER_KEY\u0026#39;=\u0026#39;/mnt/data/certs/private.key\u0026#39; -e \u0026#39;FLEET_MDM_WINDOWS_WSTEP_IDENTITY_CERT\u0026#39;=\u0026#39;/mnt/data/win_mdm_certs/fleet-mdm-win-wstep.crt\u0026#39; -e \u0026#39;FLEET_MDM_WINDOWS_WSTEP_IDENTITY_KEY\u0026#39;=\u0026#39;/mnt/data/win_mdm_certs/fleet-mdm-win-wstep.key\u0026#39; -e \u0026#39;FLEET_SERVER_PRIVATE_KEY\u0026#39;=\u0026#39;YOUR_SERVER_PRIVATE_KEY\u0026#39; -e \u0026#39;FLEET_LICENSE_KEY\u0026#39;=\u0026#39;YOUR_KEY_HERE\u0026#39; -e \u0026#39;FLEET_OSQUERY_STATUS_LOG_PLUGIN\u0026#39;=\u0026#39;filesystem\u0026#39; -e \u0026#39;FLEET_OSQUERY_RESULT_LOG_PLUGIN\u0026#39;=\u0026#39;filesystem\u0026#39; -e \u0026#39;FLEET_FILESYSTEM_STATUS_LOG_FILE\u0026#39;=\u0026#39;/mnt/data/logs/status.log\u0026#39; -e \u0026#39;FLEET_FILESYSTEM_RESULT_LOG_FILE\u0026#39;=\u0026#39;/mnt/data/logs/result.log\u0026#39; -e \u0026#39;FLEET_FILESYSTEM_AUDIT_LOG_FILE\u0026#39;=\u0026#39;/mnt/data/logs/audit.log\u0026#39; -e \u0026#39;FLEET_FILESYSTEM_ENABLE_LOG_ROTATION\u0026#39;=\u0026#39;true\u0026#39; -e \u0026#39;FLEET_ACTIVITY_ENABLE_AUDIT_LOG\u0026#39;=\u0026#39;true\u0026#39; -e \u0026#39;FLEET_ACTIVITY_AUDIT_LOG_PLUGIN\u0026#39;=\u0026#39;filesystem\u0026#39; -e \u0026#39;FLEET_LOGGING_DEBUG\u0026#39;=\u0026#39;true\u0026#39; -p \u0026#39;8081:8080/tcp\u0026#39; -v \u0026#39;/mnt/user/appdata/fleetdm\u0026#39;:\u0026#39;/mnt/data\u0026#39;:\u0026#39;rw\u0026#39; \u0026#39;fleetdm/fleet\u0026#39; tail -f /dev/null Now that I gave the container something to do, besides starting Fleet since that is immediately stopping, I can now pull up an interactive terminal and perform the database migrations.\n1 docker exec -it fleetdm fleet prepare db You could also run this as a non-interactive command using docker exec fleetdm fleet prepare db, but as it was the first time running this for an upgrade, I wanted to be able to walk through it without the terminal session suddenly closing.\nThat was it! Pretty painless once you know what you\u0026rsquo;re doing, but definitely something you need to be aware of when performing upgrades to Fleet and to always check if there are any pending db migrations that need to occur after.\nCatch ya on the next project!\nJosh üññ\nPhoto by Fotis Fotopoulos on Unsplash\n","date":"2025-01-26T08:33:38Z","image":"https://kc9wwh.net/p/dont-forget-to-apply-updates-to-your-db/cover_hu_51ad31639e747509.jpg","permalink":"https://kc9wwh.net/p/dont-forget-to-apply-updates-to-your-db/","title":"Don't Forget to Apply Updates to your DB"},{"content":"If you\u0026rsquo;ve ever made an effort to do a blog, you\u0026rsquo;ll understand. The real fun is learning about new things, but you also need to prioritize writing about the things you do as quickly as possible so that you can provide more detail around the things you do and be able to better talk about the challenges you faced and how you got past them. Bottom line, the longer you wait, the more it\u0026rsquo;ll show.\nSo, starting today, I\u0026rsquo;ve made a commitment to do better.\nUntil very recently I was drowning in Apple devices. But after taking a short professional break, I was left with only my Apple iPhone 15 Pro Max and my ASUS ROG Zephyrus gaming laptop with at the time Windows 11 Home. Since then I\u0026rsquo;ve replaced the cooling fans and reapplied thermal paste, as well as upgraded to Windows 11 Pro. I do have to admit that there were a lot of frustrations early on with moving all in with Windows as my daily driver. To be clear, there are still some, but overall in the last few months, Windows has started to grown on my.\nNow the largest hurdle was understanding that the Windows world loves to access their email via a web browser or Outlook. I love Apple Mail and the variety of third-party email clients available on macOS. But for whatever reason, the number on the Windows side is much much lower and so is the ascetic design qualities I\u0026rsquo;ve come to appreciate in the Apple ecosystem. I\u0026rsquo;ve tried anything that stood out and looked great, but in the end, there was always something off, something I didn\u0026rsquo;t like about it. In the end, I choose to settle with a mix of Outlook and more and more I finding myself accessing my iCloud Mail account via the web browser. This is most likely a personal preference, but for me, it was the hardest part to overcome and the lack of Apple to Microsoft integrations don\u0026rsquo;t help.\nAs I started using my computer more and more, I have gotten really comfortable with Windows again, even though I really haven\u0026rsquo;t done much technically with a Windows computer since Windows XP. That said, I am absolutely loving two big things for me as I dive more and more back into the technical side on Windows. First, I love that Microsoft has brought Linux to the platform via WSL (Windows Subsystem Linux). This allows me to access any command line utilities I was already accustomed to from working in macOS and Linux systems. On top of that, Microsoft has created a kind of redirect in Windows Command prompt and Powershell where you can use ls, rm, etc and it just \u0026ldquo;redirects\u0026rdquo; it to the appropriate Windows module and has (limited) flag support for them as well. But this has certainly made my switch much easier.\nSecondly, I absolutely love and was thrilled to find that Oh-My-Posh had support for Windows! I\u0026rsquo;m using it right now in Powershell with VIM writing this blog post in markdown and I absolutely love it! I\u0026rsquo;ll also say that Powershell is very intuitive and the modules are very well documented for those occasions where you want to write some Windows scripts.\nToday, I had the opportunity to work on a side project involving Entra ID and Microsoft Endpoint Manager (a.k.a. Intune). Now I have some previous Windows experience from when I was growing up and early on in my professional career. However, I remembered everything being scripted. So, while I was waiting for my Azure access to go through, I started planning to deploy a Powershell script to newly enrolled organizational devices. This script would install Google Chrome, Slack, and Microsoft Office 365 along with configuring a SharePoint sync through OneDrive and mapping a network drive.\nBut, when I received access to Azure and logged in, I started to realize that a lot of the features and comforts I was familiar with on the Apple MDM side, has made their way over to Windows as well. Deploying apps from the Microsoft App Store is straight forward and quick to setup. You can also use a tool called the Microsoft Win32 Content Prep Tool to create a deploy-able application from an .exe or .msi installer. Which, I did use to create a Google Chrome Enterprise package which I uploaded to Microsoft Endpoint Manager and was able to successfully deploy.\nConfiguration Profile or Configuration Policies (as they are referred to in Microsoft Endpoint Manager) provide the same type of functionality restrictions and configuration capabilities you\u0026rsquo;d come to expect on the Apple MDM side as well. Even better, Microsoft Endpoint Manager has the most common Configuration Service Providers or CSPs already loaded into the platform, so you just need to essentially search for what you are looking to configure, such as setting a home page in Google Chrome or configuring OneDrive to sync with SharePoint. Once you found the key you were looking for, just add it to the Policy, enable the key and configure and needed parameters associated with it. Next, define your scope for how, when and to whom you are going to deploy the Configuration Policy and you\u0026rsquo;re done.\nQuick Note: From my (all be it limited) experience with Windows MDM, some of these policies will not apply until a restart or the user logs out of the device.\nOnce I had the various applications ready to go in the Company Portal, along with a few Configuration Policies configured, I decided to take a look at branding the Company Portal to really make it feel as part of the organization. But, I was unfortunately disappointed at the available options for really applying a custom brand to the application. I was able to specify a custom color for the application, as well as logo and a few other minor things, but the changes on the Company Portal side were extremely minimal, mostly just changing the menu bar of the window. The rest of the applications look stayed the same and really clashed, so I ended up deleting the branding config and left it with the default.\nAnyway, on Monday its back to testing and improving the build process for when we have to reload a system or setup a new device for someone.\nTill Next Time!\nJosh üññ\nPhoto by Jerry Kavan on Unsplash\n","date":"2025-01-24T16:10:38-06:00","image":"https://kc9wwh.net/p/the-first-issue-with-starting-a-blog/cover_hu_321884632ec9a337.jpg","permalink":"https://kc9wwh.net/p/the-first-issue-with-starting-a-blog/","title":"The First Issue with Starting a Blog"},{"content":"I\u0026rsquo;ve been wanting to start my own blog for quite some time, but it wasn\u0026rsquo;t much of a priority in the past. Now, I find myself kicking myself for not doing this sooner! That said, I\u0026rsquo;m thrilled to share that I\u0026rsquo;ve finally spun up my personal blog and look forward to sharing my knowledge with anyone interested.\nSo, why not start out by talking about my journey with Hugo? If you\u0026rsquo;re not familiar with Hugo, it is one of the leading static website generators out there. It\u0026rsquo;s extremely fast and pretty easy to use. I will admit, however, that the learning curve can be a bit frustrating at first. While all templates use the same framework, they each have their own unique quirks and niche differences.\nLearning Hugo I didn\u0026rsquo;t need to reinvent the wheel to get started with Hugo, and I want to give credit where it\u0026rsquo;s due. Two fantastic videos taught me everything I needed to know to get up and running with Hugo and even take things to the next level:\n1. Luke Smith\u0026rsquo;s Video The first video that I recommend watching is Hugo Actually Explained (Websites, Themes, Layouts and Intro to Scripting) by Luke Smith. This video provides a fundamental understanding of Hugo and its data structure. It\u0026rsquo;s an excellent starting point for anyone new to Hugo.\n2. JW Caterine\u0026rsquo;s Video The second video that I found incredibly helpful was How to Setup a Portfolio Website with Hugo by JW Caterine. Initially, I encountered some issues getting the Stacks theme to work on my setup, but these turned out to be computer-specific problems. This video walks you through a complete cloud-hosted solution and gets you up and running with Hugo in no time. Even better, the solution is free to use.\nWhy Hugo? With over 20 years of experience in IT and SaaS, I\u0026rsquo;ve worked with countless platforms and tools. Hugo stands out because of its speed, simplicity, and the control it offers. As someone who values efficiency and customization, Hugo fits perfectly into my workflow. Whether you\u0026rsquo;re a seasoned professional or just starting out, it\u0026rsquo;s a tool worth exploring.\nWhat to Expect In future posts, I plan to dive deeper into technical topics, share insights from my years in the industry, and provide tips and tutorials for fellow tech enthusiasts. My goal is to create a resource that others can learn from and build upon.\nIf you\u0026rsquo;re considering starting a blog or experimenting with static site generators, I highly recommend giving Hugo a try. Stay tuned for more updates, and feel free to reach out with any questions or suggestions. Let\u0026rsquo;s build something great together!\nPhoto by Thomas Jensen on Unsplash\n","date":"2025-01-01T23:33:38Z","image":"https://kc9wwh.net/p/starting-my-journey-with-hugo/cover_hu_fb74f67d456dd6f0.jpg","permalink":"https://kc9wwh.net/p/starting-my-journey-with-hugo/","title":"Starting my journey with Hugo"},{"content":"Hello! üëã\nAfter 20+ years working in IT and in SaaS, I\u0026rsquo;ve decided to create my own blog. Why you may ask? Well, I\u0026rsquo;ve always loved sharing information with others and especially my team members, but I\u0026rsquo;ve decided to broaden that now and share my knowledge with the world. I\u0026rsquo;ll use this platform to share information that I\u0026rsquo;ve learned while working on various projects, currently learning Hugo and Fleet Device Management. But with over 5 years in Cellular Engineering, 8 Years in Systems Adminsitration, and over 8 years in Mobile Device Management and SaaS, I\u0026rsquo;m sure there is something we share in common.\nHere\u0026rsquo;s to another year of growth and education! üçª\nPhoto by Dino Reichmuth on Unsplash\n","date":"2025-01-01T23:19:06Z","image":"https://kc9wwh.net/p/the-start-of-a-journey/cover_hu_14f38b054fdf6334.jpg","permalink":"https://kc9wwh.net/p/the-start-of-a-journey/","title":"The start of a journey"}]